version: '3'

services:
  nginx:
    image: nginx
    ports:
    - "80:80"
    volumes:
    - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
    - app
  app:
    build: ./python
    ports:
    - "8080:8080"
    - "8888:8888"
    volumes:
    - ./python:/home/jovyan
    working_dir: /home/jovyan/src
    command: gunicorn -w 4 --timeout 300  -b 0.0.0.0:8080 wsgi:app
  web:
    build:
      context: .
      dockerfile: web/Dockerfile
    volumes:
    - ./python/src/static/data:/app/web/data
    - ./web/dist:/app/web/dist
    - ./web/src:/app/web/src
    ports:
    - "1234:1234"
    - "8080:8080"
    command: yarn develop
